#* @vtlvariable name="elw_messages" type="elw.miniweb.Message[]" *#
#* @vtlvariable name="elw_ctx" type="elw.dao.Ctx" *#
#* @vtlvariable name="format" type="elw.web.FormatTool" *#
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
	<meta content="text/html; charset=UTF-8">
	<title>Course ${elw_ctx.course.name} Structure</title>
	#elw_imports("../")
</head>
<body>
<div id="elw_header">
	<div id="nav"><a href="courses">My Courses</a> &gt; <span style="font-weight: bold">${elw_ctx.course.name}</span>
	</div>
	#elw_cred_stud($elw_ctx)
	<div id="header_hr"></div>
</div>
	#elw_messages($elw_messages)
<div id=main>
	<table cellspacing="0">
		<tbody>
		<tr>
			<th>Name</th>
			<th>State</th>
			<th>Score</th>
		</tr>
			#foreach($entry in $elw_ctx.enr.index)
				#set($idx = $velocityCount - 1)
				#set($elw_ctx_ass = $elw_ctx.extendIndex($idx))
				#set($verIdx = $elw_ctx.student.idAsInt % $elw_ctx_ass.ass.versions.size())
				#set($elw_ctx_ver = $elw_ctx_ass.extendVer($elw_ctx_ass.ass.versions.get($verIdx)))
				#set($started = $elw_ctx.enr.classes.get($elw_ctx_ass.indexEntry.classFrom).started)
				#set($filesStud = $fileMetas.get("$elw_ctx_ver.toString()"))
			<tr class="elw_header_row">
				<td style="padding-left: 2em; padding-right: 1em; border-right: #999999 dashed 1px;">
					<span style="font-weight: bold;">$elw_ctx_ass.ass.name</span> $elw_ctx_ass.assType.name</td>
				<td style="padding: 0 0.25em; text-align: center;">
					#if($started)
						<a class="expandTrigger"
							 id="index-$idx">Opened $format.format($elw_ctx.enr.classes.get($elw_ctx_ass.indexEntry.classFrom).fromDateTime.millis)</a>
					#else
						Opens $format.format($elw_ctx.enr.classes.get($elw_ctx_ass.indexEntry.classFrom).fromDateTime.millis)
					#end
				</td>
				<td style="padding: 0 0.25em; text-align: right;">
					#if($scores.get("$elw_ctx_ver"))
						#elw_score($elw_ctx_ver, $scores.get("$elw_ctx_ver")) of
					#else
						&nbsp;
					#end
					$elw_ctx_ass.indexEntry.scoreBudget
				</td>
			</tr>
				#if($elw_ctx.enr.classes.get($elw_ctx_ass.indexEntry.classFrom).started)
				<tr class="index-$idx" style="display:none;">
					<td style="padding-left: 2.5em; padding-right: 1em; border-right: #999999 dashed 1px;">$elw_ctx_ver.ver.name</td>
					<td style="padding: 0 0.25em; text-align: center;">
						#foreach($slot in $elw_ctx_ass.assType.fileSlots)
							<a class="expandTrigger" id="index-${idx}--slot-${slot.id}" title="$slot.name">$slot.shortName:<span
											style="font-weight: bold;">$elw_ctx_ver.ver.countFiles($elw_ctx_ass.assType, $elw_ctx_ass.ass, $slot.id, $filesStud)</span></a>
						#end
					</td>
					<td style="padding: 0 0.25em; text-align: right;">
					</td>
				</tr>
					#foreach($slot in $elw_ctx_ass.assType.fileSlots)
					<tr class="index-${idx}--slot-${slot.id}" style="display:none;">
						<td style="padding-left: 3em; padding-right: 1em; border-right: #999999 dashed 1px;">
							<span style="font-weight: bold;" title="${slot.id}">${slot.name}</span>&nbsp;
							#if($slot.readApprovals.size() > 0)
								Readable after : <span
											style="font-weight: bold;">#foreach($slotId in $slot.readApprovals) ${elw_ctx_ass.assType.findSlotById($slotId).name} #end</span>
							#end
							#if($slot.writable)
								#if($slot.writeApprovals.size() > 0)
									Writable after : <span
												style="font-weight: bold;">#foreach($slotId in $slot.writeApprovals) ${elw_ctx_ass.assType.findSlotById($slotId).name} #end</span>
								#end
							#else
								<span style="font-weight: bold;">Read-only</span>
							#end
							#if($elw_ctx_ver.indexEntry.classDue.get($slot.id))
								#set($classDue = $elw_ctx.enr.classes.get($elw_ctx_ver.indexEntry.classDue.get($slot.id)))
								#if($classDue.passed)
									<span style="color: red;">
										Due $format.format($classDue.toDateTime.millis)
									</span>
								#else
									Due $format.format($classDue.toDateTime.millis)
								#end
							#end
						</td>
						<td style="padding: 0 0.25em; text-align: center;">
							<a class="expandTrigger" id="index-${idx}--slot-${slot.id}--files">Files:&nbsp;<span
											style="font-weight: bold;">$elw_ctx_ver.ver.countFiles($elw_ctx_ass.assType, $elw_ctx_ass.ass, $slot.id, $filesStud)</span></a>
							<a class="popupTrigger" id="index-${idx}--slotinfo-${slot.id}">Details</a>
						</td>
						<td style="padding: 0 0.25em; text-align: right; position: relative;">
							<div style="display: none;" class="popup index-${idx}--slotinfo-${slot.id}">
								Content Types : <span
											style="font-weight: bold;">#foreach($contentType in $slot.contentTypes) ${contentType} #end</span><br/>
								Max Size : <span style="font-weight: bold;">${slot.lengthLimit}</span><br/>
								Name Regex : <span style="font-weight: bold;">${slot.nameRegex}</span><br/>
							</div>
						</td>
					</tr>
						#elw_file_row($elw_ctx_ver, $slot, $elw_ctx_ver.assType.getFiles($slot.id), "t")
						#elw_file_row($elw_ctx_ver, $slot, $elw_ctx_ver.ass.getFiles($slot.id), "a")
						#elw_file_row($elw_ctx_ver, $slot, $elw_ctx_ver.ver.getFiles($slot.id), "v")
						#elw_file_row($elw_ctx_ver, $slot, $filesStud.get($slot.id), "s")
						#if($elw_ctx_ver.ver.checkWrite($elw_ctx_ver.assType, $elw_ctx_ver.ass, $slot.id, $filesStud))
							<tr class="index-${idx}--slot-${slot.id}" style="display:none;">
								<td style="padding-left: 4em; padding-right: 1em; border-right: #999999 dashed 1px;">
									<form method="POST" enctype="multipart/form-data" 
												action="ul?elw_ctx=$elw_ctx_ver&sId=$slot.id" style="display: inline;">
										<input type="hidden" name="expandTriggers" value="[]"/>
										<input type="text" name="comment" value="" title="Add a note"/>
										<input type="file" name="file" title="Select a file..."/>
										<input type="submit" value="Upload"/>
									</form>
								</td>
								<td style="padding: 0 0.25em; text-align: center;">
								</td>
								<td style="padding: 0 0.25em; text-align: right; position: relative;">
								</td>
							</tr>
						#end
					#end
				#end
			#end
		<tr>
			<td style="padding-left: 1em;">&nbsp;</td>
			<td style="padding: 0 0.25em;">Total Score:</td>
			<td style="padding: 0 0.25em; text-align: right;">$grossScore</td>
		</tr>
		</tbody>
	</table>
</div>
</body>
<script type="text/javascript">
	jQuery(document).ready(function() {
		jQuery($expandTriggers).each(function(index){
			elw_expand(this);
		});
	});
</script>
</html>