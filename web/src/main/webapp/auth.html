<html xmlns="http://www.w3.org/1999/xhtml">
<head>
  <meta content="text/html; charset=UTF-8">
  <title>Login</title>
  <link type="text/css" rel="stylesheet" href="css/openid.css"/>

  <script type="text/javascript" src="js/jquery-1.4.2.js"></script>
  <script type="text/javascript" src="js/jquery.cookie.js"></script>
  <script type="text/javascript" src="js/jquery.codecs.js"></script>
  <script type="text/javascript" src="js/jquery-ui-1.8.5.custom.min.js"></script>
  <script type="text/javascript" src="js/underscore-1.3.3.js"></script>
  <script type="text/javascript" src="js/backbone-0.9.2.js"></script>
  <script type="text/javascript" src="js/json2-fc535e9cc8.js"></script>
  <script type="text/javascript" src="js/jquery.dataTables.js"></script>
  <script type="text/javascript" src="js/openid-jquery.js"></script>
  <script type="text/javascript" src="js/openid-ru.js"></script>
  <script type="text/html" id="SessionMessage_template">
    <div class="<%-message.severity%>"><% message.text %></div>
  </script>
</head>
<body>
<div id="SessionMessageList_target">
  <div id="SessionMessageList_messageArea"></div>
  <div><a id="SessionMessageList_clearAll" href="#">Clear all messages</a></div>
</div>
<div style="margin: 3em auto; padding: 1em; width: 600px;">
  <div>
    <form action="auth/nameresponse" method="post" id="name_form" accept-charset="utf-8">
      <fieldset>
        <legend>Simple Authentication</legend>
          <label for="name_last" style="display: inline-block; width: 10em;">Last Name:</label>
          <input id="name_last" name="name_last" type="text"
                 value="Dobbs"/><br/>
          <label for="name_first" style="display: inline-block; width: 10em;">First Name:</label>
          <input id="name_first" name="name_first" type="text"
                 value="Bob"/>
          <input id="name_submit" type="submit" value="Verify"/>
      </fieldset>
    </form>
  </div>
  <div>
    <form action="auth/smtpchallenge" method="post" id="smtp_form" accept-charset="utf-8">
      <fieldset>
        <legend>Email Token Authentication</legend>
          <label for="smtp_email">Specify your email:</label>
          <input id="smtp_email" name="email" type="text"
                 value="bob@dobbs.com"/>
          <input id="smtp_submit" type="submit" value="Verify"/>
      </fieldset>
    </form>
  </div>
  <div>
    <form action="auth/oidchallenge" method="get" id="openid_form" accept-charset="utf-8">
      <input type="hidden" name="action" value="verify"/>
      <fieldset>
        <legend>OpenID Authentication</legend>
        <div id="openid_choice">
          <p>Please choose your OpenID provider:</p>

          <div id="openid_btns"></div>
        </div>
        <div id="openid_input_area">
          <label for="openid_identifier"></label>
          <input id="openid_identifier" name="openid_identifier" type="text"
                 value="http://"/>
          <input id="openid_submit" type="submit" value="Verify"/>
        </div>
      </fieldset>
    </form>
  </div>
</div>
</body>
<script type="text/javascript">
  jQuery(document).ready(function () {
    openid.img_path = "css/images/";
    openid.init('openid_identifier');

    jQuery('input[type=text]').bind('focus', function() {
      this.select();
    });

    var SessionMessage = Backbone.Model.extend({
      "defaults": function() {
        return {
          stamp: 0,
          severity: "message_minor",
          text: "Default message"
        };
      }
    });

    var SessionMessageList = Backbone.Collection.extend({
      model: SessionMessage,
      localStorage: new Store()
    });

    var sessionMessageList = new SessionMessageList();

    var SessionMessageView = Backbone.View.extend({
      tagName: 'div',
      template: _.template(jQuery('#SessionMessage_template').html()),
      events: {
        "click a.destroy" : "destroy"
      },

      initialize: function() {
        this.model.bind('change', this.render, this);
        this.model.bind('destroy', this.destroy, this);
      },

      render: function() {
        this.$el.html(this.template(this.model.toJSON()));
        return this;
      },

      destroy: function() {
        this.model.destroy();
      }
    });

    var SessionMessageListView = Backbone.View.extend({
      el: jQuery("#SessionMessageList_target"),
      events: {
        "click #SessionMessageList_clearAll": "clearAll"
      },
      initialize: function() {
        this.clearAll = this.$('#SessionMessageList_clearAll');

        sessionMessageList.bind('add', this.addOne, this);
        sessionMessageList.bind('reset', this.addAll, this);
        sessionMessageList.bind('all', this.render, this);

        sessionMessageList.fetch();
      },
      render: function() {
        var messageCount = SessionMessageList.length;

        if (messageCount) {
          this.clearAll.show();
        } else {
          this.clearAll.hide();
        }
      },
      addOne: function(sessionMessage) {
        var view = new SessionMessageView({model: sessionMessage});
        this.$("#SessionMessageList_messageArea").append(view.render().el);
      },
      addAll: function() {
        sessionMessageList.each(this.addOne);
      }
    });
    var sessionMessageListView = new SessionMessageListView();
  });
</script>
</html>
