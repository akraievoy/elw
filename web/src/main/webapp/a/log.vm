#* @vtlvariable name="elw_ctx" type="elw.dao.Ctx" *#
#* @vtlvariable name="format" type="elw.web.FormatTool" *#
#* @vtlvariable name="f_noDues" type="java.lang.Boolean" *#
#* @vtlvariable name="f_latest" type="java.lang.Boolean" *#
#* @vtlvariable name="f_studId" type="java.lang.String" *#
#* @vtlvariable name="f_slotId" type="java.lang.String" *#
<html>
<head>
 <meta content="text/html; charset=UTF-8">
 <title>Group $elw_ctx.group.name Report Uploads : ELW Admin</title>
 #parse("/__/imports.vm")
</head>
<body style="text-align: left;">
<div class="ui-widget-header ui-corner-all" id="elw_header">
 <div id="nav"><a href="index">Index</a> &gt; <a href="enrolls">Enrollments</a> &gt; <span style="font-weight: bold">Group $elw_ctx.group.name
  Uploads</span></div>
 #elw_cred_adm($auth)
 <div id="header_hr"></div>
</div>
 #parse("/__/messages.vm")
 <div style="float: left;">
  <form style="text-align: center;">
   <input type="hidden" name="elw_ctx" value="$elw_ctx.toString()"/>
   <select name="f_studId"><option value="">Choose...</option></select>
   <select name="f_slotId"><option value="">Choose...</option></select>
   <input type="checkbox" name="f_nodues" value="true"/>No&nbsp;dues
   <input type="checkbox" name="f_latest" value="true"/>Latest&nbsp;only
   <input id="dataLoader" type="button" value="Refresh"/>
  </form>
  <table id="dataTable" cellspacing="0"></table>
 </div>
</body>
<script type="text/javascript">
 jQuery(document).ready(function() {
  var f_studId = jQuery("select[name=f_studId]");
  #foreach($stud in $elw_ctx.group.students)
   f_studId.append(
     jQuery("<option></option>").attr("value", $format.json($stud.id)).text($format.json($stud.getName()))
   );
  #end
  var f_slotId = jQuery("select[name=f_slotId]");
  #foreach($aType in $elw_ctx.course.assTypes)
   #foreach($slot in $aType.fileSlots)
   f_slotId.append(
     jQuery("<option></option>")
       .attr("value", $format.json($aType.id) + "--" + $format.json($slot.id))
       .text($format.json($aType.name) + " - " + $format.json($slot.name)
     )
   );
   #end
  #end

  #if($f_noDues)
   jQuery("input[name=f_nodues]").attr("checked", $f_noDues);
  #end
  #if($f_latest)
   jQuery("input[name=f_latest]").attr("checked", $f_latest);
  #end
  #if($f_slotId)
   jQuery("select[name=f_slotId]").val($format.json($f_slotId));
  #end
  #if($f_studId)
   jQuery("select[name=f_studId]").val($format.json($f_studId));
  #end

  var dataTable = jQuery('#dataTable').dataTable({
   "sDom": 'lprf<"clear">ti',
   'aaData': [ ],
   'aoColumns': [
    #* 0 index *# {"bVisible": false, "bSortable": false},
    #* 1 upload millis *# {"bVisible": false, "bSortable": false},
    #* 2 upload date - full *# {"bVisible": false, "bSortable": false},
    #* 3 upload date - nice*# {'sTitle': 'Time', "iDataSort": 1, "sWidth": "7em"},
    #* 4 author.id *# {"bVisible": false, "bSortable": false},
    #* 5 author.name *# {'sTitle': 'Author', "iDataSort": 3, "sWidth": "13em"},
    #* 6 class.index *# {"bVisible": false, "bSortable": false},
    #* 7 class.name *# {'sTitle': 'Class', "iDataSort": 5, "sWidth": "11em"},
    #* 8 slot.id *# {"bVisible": false, "bSortable": false},
    #* 9 slot.name *# {'sTitle': 'Slot', "iDataSort": 7, "sWidth": "5em" },
    #* 10 comment *# {'sTitle': 'Comment', "sWidth": "21em" },
    #* 11 status text*# {'sTitle': 'Status', "sWidth": "7em" },
    #* 12 status classes *# {"bVisible": false, "bSortable": false},
    #* 13 approve *# {'sTitle': 'A', "sWidth": "1em", "bSortable": false },
    #* 14 download *# {'sTitle': 'D', "sWidth": "1em", "bSortable": false }
   ],
   "aaSorting": [ [3,'asc'] ],
   "aaSortingFixed": [ ],
   "fnRowCallback": function(node, data, dispIndex, dataIndex) {
    jQuery("td:eq(5)", node).toggleClass(data[12]);
    jQuery("td:eq(0)", node).attr("title", data[2]);
    return node;
   }
  });

  function loadData() {
   var f_data = {};
   f_data["elw_ctx"] = jQuery("input[name=elw_ctx]").val();
   f_data["f_studId"] = jQuery("select[name=f_studId]").val();
   f_data["f_slotId"] = jQuery("select[name=f_slotId]").val();
   f_data["f_nodues"] = jQuery("input[name=f_nodues]").attr("checked");
   f_data["f_latest"] = jQuery("input[name=f_latest]").attr("checked");


   jQuery.ajax({
    "type": "GET",
    "url": "rest/log",
    "data": f_data,
    "success": function(resp) {
     if (resp == null || !resp.success) {
      jQuery.jGrowl("Response error", {"header":"AJAX error", "theme": "ui-state-error"});
      return;
     }

     dataTable.fnClearTable(resp.data.length == 0);
     dataTable.fnAddData(resp.data);
    },
    "error": function() {
     jQuery.jGrowl("General error", {"header":"AJAX error", "theme": "ui-state-error"});
    },
    "dataType": 'json'
   });

   return false;
  }

  jQuery("#dataLoader").click(loadData);

  loadData();
 });
</script>
 #parse("/__/ready.vm")
</html>
