#* @vtlvariable name="elw_messages" type="elw.miniweb.Message[]" *#
#* @vtlvariable name="elw_ctx" type="elw.dao.Ctx" *#
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
	<meta content="text/html; charset=UTF-8">
	<title>Course ${elw_ctx.course.name} : ELW Admin</title>
	#elw_imports("../")
</head>
<body>
<div id="elw_header">
	<div id="nav"><a href="index">Index</a> &gt; <a href="courses">Courses</a> &gt; <span style="font-weight: bold">${elw_ctx.course.name}</span></div>
	#elw_cred_adm($auth)
	<div id="header_hr"> </div>
</div>
#elw_messages($elw_messages)
<div id=main>
	<table cellspacing="0" cellpadding="0"><tbody>
	<tr>
		<td style="padding-left: 1em;padding-right: 0.25em; width: 40em;">Types:</td>
		<td style="width: 10em;">&nbsp;</td>
		<td style="width: 6em;">&nbsp;</td>
	</tr>
	#foreach($assType in $elw_ctx.course.assTypes)
		#set($elw_ctx_type = $elw_ctx.extendAssType($assType))
	<tr>
		<td style="padding-left: 1.5em; padding-right: 0.25em;">${assType.name}</td>
		<td style="text-align: center;">
			<span class="expandTrigger" id="${assType.id}">Tasks</span>&nbsp;<span class="expandTrigger" id="slots-${assType.id}">Slots</span>
		</td>
		<td>&nbsp;</td>
	</tr>
		#foreach($slot in $assType.fileSlots)
		<tr class="slots-${assType.id}" style="display: none;">
			<td style="padding-left: 2.5em; padding-right: 0.25em; position:relative;" >
				<span title="id=${slot.id}">${slot.name}</span>
			</td>
			<td style="text-align: center;">
				<span class="expandTrigger" id="slots-${assType.id}-${slot.id}--files">Files</span>
				<span class="popupTrigger" id="slots-${assType.id}-${slot.id}">Details</span>
			</td>
			<td>
				<div style="display:none; width: 12em;" class="slots-${assType.id}-${slot.id} popup">
					Binary? : <span style="font-weight: bold;">#if($slot.binary)Yes#{else}No#end</span><br/>
					Content Types : <span style="font-weight: bold;">#foreach($contentType in $slot.contentTypes) ${contentType} #end</span><br/>
					Max Size : <span style="font-weight: bold;">${slot.lengthLimit}</span><br/>
					Name Regex : <span style="font-weight: bold;">${slot.nameRegex}</span><br/>
					<hr/>
					Writable? : <span style="font-weight: bold;">#if($slot.writable)Yes#{else}No#end</span><br/>
					#if($slot.writeApprovals.size() > 0)
					Writable after : <span style="font-weight: bold;">#foreach($slotId in $slot.writeApprovals) $assType.findSlotById($slotId).name #end</span><br/>
					#end
					#if($slot.readApprovals.size() > 0)
					Readable after : <span style="font-weight: bold;">#foreach($slotId in $slot.readApprovals) $assType.findSlotById($slotId).name #end</span><br/>
					#end
				</div>
			</td>
		</tr>
			$assType.getFiles(${slot.id})
			#foreach($file in $assType.getFiles(${slot.id}))
				<tr class="slots-${assType.id}-${slot.id}--files" style="display:none;">
					<td style="padding-left: 4em; padding-right: 1em; border-right: #999999 dashed 1px;">
						<a style="font-weight: bold;" title="${file.meta.id} @ t"
							 href="../s/dl/${file.meta.name}?elw_ctx=$elw_ctx_type&s=t&sId=$slot.id&fId=$file.meta.id"
										>${file.meta.name}</a>
						$format.format($file.meta.createStamp.time) $file.meta.author $file.meta.sourceAddress
					</td>
					<td style="padding: 0 0.25em; text-align: center;">
						#if(!$slot.binary)
							<a class="popupTrigger"
								 id="slots-${assType.id}-${slot.id}--files--t-${file.meta.id}">Content</a>
						#end
						#if($file.meta.comment && $file.meta.comment.length() > 0)
							<a class="popupTrigger"
								 id="slots-${assType.id}-${slot.id}--files--t-${file.meta.id}--comm">Note</a>
						#end
					</td>
					<td style="padding: 0 0.25em; text-align: right;">
						#if(!$slot.binary)
							<div style="display: none; text-align: left;"
									 class="popup slots-${assType.id}-${slot.id}--files--t-${file.meta.id}">
								${file.text}
							</div>
						#end
						#if($file.meta.comment && $file.meta.comment.length() > 0)
							<div style="display: none; text-align: left;"
									 class="popup slots-${assType.id}-${slot.id}--files--t-${file.meta.id}--comm">
								$file.meta.comment
							</div>
						#end
					</td>
				</tr>
			#end
		<tr class="slots-${assType.id}-${slot.id}--files" style="display:none;">
			<td style="padding-left: 4em; padding-right: 1em; border-right: #999999 dashed 1px;">
				<form method="POST" enctype="multipart/form-data"
							action="ul?elw_ctx=$elw_ctx_type&s=t&sId=$slot.id" style="display: inline;">
					<input type="hidden" name="expandTriggers" value="[]"/>
					<input type="text" name="comment" value="" title="Add a note"/>
					<input type="file" name="file" title="Select a file..."/>
					<input type="submit" value="Upload"/>
				</form>
			</td>
			<td style="padding: 0 0.25em; text-align: center;">
			</td>
			<td style="padding: 0 0.25em; text-align: right; position: relative;">
			</td>
		</tr>
		#end
		#foreach($ass in $assType.assignments)
	<tr class="elw_header_row ${assType.id}" style="display: none;" >
		<td style="padding-left: 2em; padding-right: 0.25em;">
			<span title="id=#if($ass.id)$ass.id#{else}null#end">$ass.name</span>
		</td>
		<td style="text-align: center;">
			<span class="expandTrigger" id="${assType.id}__${ass.id}">Versions</span>
		</td>
		<td>&nbsp;</td>
	</tr>
		#foreach($ver in $ass.versions)
		#set($assCtx=$elw_ctx.extendTAV(${assType}, ${ass}, ${ver}))
	<tr class="${assType.id}__${ass.id}" style="display: none;">
		<td style="padding-left: 3em;">
			$ver.name&nbsp;<span style="font-size: smaller">(id:&nbsp;#if($ver.id)$ver.id#{else}null#end)</span>
		</td>
		<td style="text-align: center;">
			[&nbsp;<a href="launch?elw_ctx=$assCtx">Code</a>&nbsp;]
		</td>
		<td style="padding-left: 0.25em; padding-right: 0.25em;">
			#if($testResults)
			#set($res=$testResults.get($assCtx.toString()))
				#if($res.success)#set($resColor="#00FF00")#else#set($resColor="#FF0000")#end
				<span style="color:$resColor">$res.message</span>
			#else
				&nbsp;
			#end
		</td>
	</tr>
		#end
	 #end
	#end
	</tbody></table>
</div>
</body>
</html>